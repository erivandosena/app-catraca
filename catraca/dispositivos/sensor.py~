#!/usr/bin/env python
# -*- coding: latin-1 -*-

import pingo 
from time import sleep
from catraca import configuracao 
from catraca.dispositivos import display
from catraca.dispositivos import leitor
from catraca.dispositivos import solenoide

__author__ = "Erivando Sena" 
__copyright__ = "Copyright 2015, Unilab" 
__email__ = "erivandoramos@unilab.edu.br" 
__status__ = "Prototype" # Prototype | Development | Production 


placa = configuracao.pinos_rpi()

sensor_1 = placa.pins[19]
sensor_2 = placa.pins[21]

sensor_1.mode = configuracao.pino_entrada()
sensor_2.mode = configuracao.pino_entrada()

baixo = configuracao.pino_baixo()
alto = configuracao.pino_alto()


"""
def ler_cartao():
    display.display("Bem-vindo!","Aproxime CARTAO",2,0)
    ID = leitor.leitor()
    if (ID == 3995148318) or (ID == 3995121086):
        sleep(4)
        print 'Cartão válido. '+ str(ID)
        display.display("ID: "+str(ID),"Administrador",2,0)
        return True
    else:
        sleep(4)
        print 'Cartão inválido.'
        display.display("ID: "+str(ID),"Não Cadastrado!",2,0)
        return False
"""


def ler_sensores():
    try:
        while True:
            if (sensor_1.state == baixo) & (sensor_2.state == baixo):
                #display.display("Aguardando GIRO","<- ou ->",2,0)
                sensores()
            else:    
                if sensor_1.state == alto:
                    #display.display("GIRANDO...","HORARIO ->",2,0)
                    ler_sensor_1()
                if sensor_2.state == alto:
                    #display.display("GIRANDO...","ANTIHORARIO <-",2,0)
                    ler_sensor_2()
    except KeyboardInterrupt:
        print '\nInterrupido manualmente' # pass
    except Exception:
        print '\nErro geral [Sensores].'
    finally:
        display.display("Catraca","OFFLINE",2,0)
        configuracao.limpa_pinos()
        print 'Sensor finalizado'


def sensores():
    #while (sensor_1.state == baixo) & (sensor_2.state == baixo):
    print('Catraca aguardando GIRO <- ou ->')
        

def ler_sensor_1(): 
    #display.display("GIRANDO...","HORARIO ->",2,0)
    #while sensor_1.state == alto:
    #solenoide.magnetiza_solenoides()
    print('GIRANDO... A CATRACA NO SENTIDO HORARIO ->')
			

def ler_sensor_2():
    #display.display("GIRANDO...","ANTIHORARIO <-",2,0)
    #while sensor_2.state == alto:
    #solenoide.magnetiza_solenoides()
    print('GIRANDO... A CATRACA NO SENTIDO ANTIHORARIO <-')


