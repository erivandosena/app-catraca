<?php


class VinculoController{
	
	public static function main($tela){
		switch ($tela){
			case Sessao::NIVEL_SUPER:
				$controller = new VinculoController();
				$controller->telaVinculo();
				/*
				 * Queremos 
				 * um formulario de pesquisa. 
				 * Ao digitar um nome, vamos buscar. 
				 * Temos uma lista que tras SIAP, Matricula, Nome, documentos. 
				 * Vamos fazer o teste. 
				 * 
				 */
				
				break;
			case Sessao::NIVEL_DESLOGADO:
				break;
			default:
				break;
		}
		
		
	
	
	}
	public function telaVinculo(){
		
		echo '								
									<form method="post" action="" class="formulario em-linha" >
										<div class="borda">
										<label for="opcoes-1">
											<object class="rotulo texto-preto">Buscar por: </object>
											<select name="opcoes-1" id="opcoes-1" class="texto-preto">
												<option value="1">Nome</option>
												<option value="2">CPF</option>
												<option value="3">RG</option>
												<option value="3">Matr√≠cula</option>							            										            
												<option value="3">Vinculo</option>
												<option value="3">SIAPE</option>
											</select>
											<input class="texto-preto" type="text" name="nome" id="campo-texto-2" /><br>
											<input type="submit" />											    
										</label>
									</form>';
		
		
		
		if(isset($_POST['nome'])){
			$pesquisa = preg_replace('/[^[:alnum:]]/', '',$_POST['nome']);
			$pesquisa = strtoupper($pesquisa);
			$sql = "SELECT * FROM vw_usuarios_catraca WHERE nome LIKE '%$pesquisa%'";
			$dao = new DAO(null, DAO::TIPO_PG_SIGAAA);
			$result = $dao->getConexao()->query($sql);
			
			echo '<table border="1">';
			echo '<tr>';
			echo '<th>Nome: </th>';
			echo '<th>CPF: </th>';
			echo '<th>Identidade: </th>';
				
			echo '<th>Tipo: </th>';
			echo '<th>SIAPE: </th>';
			echo '<th>Status Servidor: </th>';
			echo '<th>Matricula Discente: </th>';
			echo '<th>Status Discente: </th>';
			echo '<th>Passaporte: </th>';
				
			echo '</tr>';
			foreach($result as $linha){
				echo '<tr>';
				echo '<td><a href="?selecionado='.$linha['id_usuario'].'">'.$linha['nome'].'</a></td>';
				echo '<td>'.$linha['cpf_cnpj'].'</td>';
				echo '<td>'.$linha['identidade'].'</td>';
				echo '<td>'.$linha['tipo_usuario'].'</td>';
				echo '<td>'.$linha['siape'].'</td>';
				echo '<td>'.$linha['status_servidor'].'</td>';
				echo '<td>'.$linha['matricula_disc'].'</td>';
				echo '<td>'.$linha['status_discente'].'</td>';
				echo '<td>'.$linha['passaporte'].'</td>';
				echo '</tr>';
			}
			echo '</table>';
		}
		if(isset($_GET['selecionado'])){
			if(is_int(intval($_GET['selecionado'])))
			{
				$dao = new DAO(null, DAO::TIPO_PG_SIGAAA);
				$id = intval($_GET['selecionado']);
				$sql = "SELECT * FROM vw_usuarios_catraca WHERE id_usuario = $id";
				$result = $dao->getConexao()->query($sql);
				foreach($result as $row){
					echo $row['nome'];
					break;
					
				}
				$dao->fazerConexao();
				$dao= new DAO(null, DAO::TIPO_PG_LOCAL);
				//Agora vamos pegar os vinculos ativos desse usuario. 
				$sql = "SELECT * FROM vinculo INNER JOIN usuario ON vinculo.usua_id = usuario.usua_id 
						WHERE usuario.usua_id = $id";
				$result = $dao->getConexao()->query($sql);
				foreach ($result as $row){
					print_r($row);
					
				}
				
				echo 'Adicionar Cartao';
				
				
			}
		}
	}

}


?>